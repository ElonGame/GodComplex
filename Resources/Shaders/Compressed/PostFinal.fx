#include"Inc/Global.fx"
Texture2D _TexNoise:register(t0),_TexHDR:register(t1);cbuffer cbTextureLOD:register( b1){float _LOD;float _BackLight;};struct VS_IN{float4 Position:SV_POSITION;};VS_IN VS(VS_IN t){return t;}float4 r(float2 t){float3 V=float3(0.,-2.f,0.),E=float3(0,1,0),L=float3(0.,0.,0.),r=10.*1..xxx,a=.5*1..xxx,f=_Camera2World[3].xyz,x=mul(float4(_CameraData.x*(2.*t.x-1.),_CameraData.y*(1.-2.*t.y),1.,0.),_Camera2World).xyz;float y=dot(V-f,E)/dot(x,E);y=y<0.?1000.:y;float3 P=f+y*x;y=.5*pow(abs(y),.25);float3 l=float3(0.,0.,0.);float I=length(l-P);I=pow(saturate(.42*I),3.);return y*I;}float4 PS(VS_IN t):SV_TARGET0{float4 x=TEX2D(_TexHDR,LinearWrap,t.Position.xy*INV_SCREEN_SIZE),f=lerp(.1,1.,_BackLight)*r(t.Position.xy*INV_SCREEN_SIZE);return lerp(f,x,x.w);}